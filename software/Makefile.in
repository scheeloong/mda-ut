# Begin compile flags
ifeq ($(OS),APPLE)
	GL_LIBS=-framework OpenGL -framework GLUT -framework Cocoa
else
	GL_LIBS=-lGL -lglut -lGLU
endif

CV_LIBS=`pkg-config --cflags --libs opencv`

I_FLAGS=-I ../sim -I ../vision -I ../tasks -I ../interface
L_FLAGS=-lsim -L../sim -lvision -L../vision -ltasks -L../tasks -lui -L../ui -lncurses -lm -pthread
C_FLAGS=-O3 -Wall -g

CXXFLAGS=$(I_FLAGS) $(C_FLAGS) $(L_FLAGS) $(GL_LIBS) $(CV_LIBS)
# End compile flags

# Begin files
ifndef SRCS
	SRCS:=$(wildcard *.cpp)
endif
ifndef OBJ
	OBJ:=$(patsubst %.cpp,%.o,$(SRCS))
endif

LIBVISION=../vision/libvision.a
LIBTASKS=../tasks/libtasks.a
LIBSIM=../sim/libsim.a
LIBUI=../ui/libui.a
LIB=$(LIBVISION) $(LIBTASKS) $(LIBSIM) $(LIBUI)
# End files

# Begin targets
parallel:
	make -j4 all

all: $(LIB) $(EXES)

ifdef A
$(A): $(OBJ)
	rm -f $@
	ar -cvq $@ $(OBJ)
endif

deps:
	$(CXX) -MM $(I_FLAGS) $(SRCS) > Makefile.deps

clean:
	rm -rf $(OBJ) $(EXES) $(A) ./*~

$(LIBVISION):
	+make -C `dirname $@` `basename $@`

$(LIBTASKS):
	+make -C `dirname $@` `basename $@`

$(LIBSIM):
	+make -C `dirname $@` `basename $@`

$(LIBUI):
	+make -C `dirname $@` `basename $@`
# End targets
